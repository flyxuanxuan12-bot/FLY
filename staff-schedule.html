<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>员工工作安排系统</title>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
        }
        body {
            padding: 20px;
            background-color: #f5f7fa;
        }
        .container {
            max-width: 98%; /* 调宽容器以适应周汇总的宽度 */
            margin: 0 auto;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 30px;
            overflow-x: auto; /* 允许横向滚动 */
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 24px;
        }
        /* 按钮样式 */
        .btn-group {
            text-align: center;
            margin-bottom: 20px;
        }
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            background: #1677ff;
            color: #fff;
            cursor: pointer;
            font-size: 14px;
            margin: 0 5px;
            transition: background 0.2s;
        }
        .btn:hover {
            background: #0d66d0;
        }
        /* 按月分隔日历核心样式 */
        .calendar {
            display: none;
            gap: 30px;
            flex-wrap: wrap;
            justify-content: flex-start;
        }
        .calendar.active {
            display: flex;
        }
        .calendar-month {
            width: calc(33.333% - 20px);
            min-width: 300px;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 15px;
            background: #fafafa;
        }
        .month-title {
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            color: #1677ff;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
        }
        .month-week-header {
            display: grid;
            /* 8列：周一到周日 + 周汇总 */
            grid-template-columns: repeat(8, 1fr);
            gap: 5px;
            margin-bottom: 8px;
        }
        .month-week-header span {
            text-align: center;
            font-weight: bold;
            color: #666;
            padding: 6px 0;
            font-size: 13px;
        }
        .month-days {
            display: grid;
            /* 8列：日期列 + 周汇总按钮列 */
            grid-template-columns: repeat(8, 1fr);
            gap: 5px;
        }
        .day-cell {
            padding: 10px 0;
            text-align: center;
            border-radius: 4px;
            font-size: 14px;
            transition: all 0.2s;
            border: 1px solid #eee;
            cursor: pointer;
            background: #fff;
            min-height: 42px; /* 保证高度一致 */
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .day-cell.empty {
            border: none;
            background: transparent;
            cursor: default;
        }
        .day-cell:hover:not(.empty) {
            background: #e6f7ff;
            border-color: #91d5ff;
        }
        .day-cell.today {
            background: #1677ff;
            color: #fff;
            border-color: #1677ff;
        }
        /* 周汇总按钮样式 */
        .week-view-btn-cell {
            text-align: center;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .week-view-btn {
            width: 100%;
            height: 100%;
            font-size: 12px;
            border: none;
            border-radius: 4px;
            background: #52c41a;
            color: #fff;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 4px;
            line-height: 1.2;
        }
        .week-view-btn:hover {
            background: #389e0d;
        }
        /* 工作安排表样式 */
        .schedule-table {
            display: none;
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .schedule-table.active {
            display: table;
        }
        .schedule-table th, .schedule-table td {
            border: 1px solid #ccc;
            padding: 12px;
            text-align: left;
            vertical-align: top;
        }
        .schedule-table th {
            background: #f2f2f2;
            font-weight: bold;
            color: #333;
        }
        .schedule-table td.employee {
            background: #f9f9f9;
            font-weight: 500;
            cursor: default;
            white-space: nowrap; /* 姓名不换行 */
        }
        .schedule-table td.input-cell {
            min-height: 60px;
            outline: none;
            cursor: text;
        }
        .schedule-table td.input-cell:focus {
            background: #fffbe6;
            border-color: #ffc53d;
        }
        /* 状态下拉框样式 */
        .status-select {
            width: 100%;
            padding: 8px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            background: #fff;
            cursor: pointer;
        }
        .status-select.unavailable {
            color: #ff4d4f;
            border-color: #ff4d4f;
            background: #fff1f0;
        }
        /* 周汇总表格样式 */
        .week-summary-table {
            display: none;
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .week-summary-table.active {
            display: table;
        }
        .week-summary-table th, .week-summary-table td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
            vertical-align: middle;
            font-size: 13px;
        }
        .week-summary-table th {
            background: #f2f2f2;
            font-weight: bold;
            color: #333;
            text-align: center;
        }
        .week-summary-table td.employee {
            background: #f9f9f9;
            font-weight: 500;
            text-align: center;
            position: sticky; /* 首列固定，方便横向滚动查看 */
            left: 0;
            z-index: 2;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
        }
        .week-summary-table td.status-cell {
            text-align: center;
            white-space: nowrap;
            width: 80px;
        }
        .week-summary-table td.status-cell.unavailable {
            color: #ff4d4f;
            background-color: #fff1f0;
        }
        .date-title {
            text-align: center;
            font-size: 18px;
            color: #1677ff;
            margin-bottom: 15px;
            font-weight: 500;
        }
        /* 响应式适配 */
        @media (max-width: 1024px) {
            .calendar-month {width: calc(50% - 15px);}
        }
        @media (max-width: 640px) {
            .calendar-month {width: 100%;}
            .week-view-btn {font-size: 11px;}
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>员工工作安排系统</h1>
        <div class="btn-group">
            <button class="btn" id="backCalendar">返回日历</button>
            <button class="btn" id="exportToday">导出当日Excel</button>
            <button class="btn" id="exportAll">导出全部Excel</button>
            <button class="btn" id="exportWeek">导出本周Excel</button>
        </div>
        
        <div class="calendar active" id="calendar"></div>
        
        <div id="scheduleContainer">
            <div class="date-title" id="dateTitle"></div>
            <table class="schedule-table" id="scheduleTable">
                <thead>
                    <tr>
                        <th width="15%">员工姓名</th>
                        <th width="15%">状态</th>
                        <th width="70%">当日工作安排（点击可编辑，支持多行）</th>
                    </tr>
                </thead>
                <tbody id="scheduleTbody"></tbody>
            </table>
        </div>
        
        <div id="weekSummaryContainer">
            <div class="date-title" id="weekSummaryTitle"></div>
            <div style="overflow-x: auto;">
                <table class="week-summary-table" id="weekSummaryTable">
                    <thead id="weekSummaryThead"></thead>
                    <tbody id="weekSummaryTbody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // ===================== 配置区域 =====================
        const firebaseConfig = {
            apiKey: "AIzaSyA-q_tMZ9hxccIcQn163cnH1lm15ppIJok",
            authDomain: "staff-scheduling-system-8bde6.firebaseapp.com",
            databaseURL: "https://staff-scheduling-system-8bde6-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "staff-scheduling-system-8bde6",
            storageBucket: "staff-scheduling-system-8bde6.firebasestorage.app",
            messagingSenderId: "611008571565",
            appId: "1:611008571565:web:d383451c1d503cbdb6be24"
        };
        const EMPLOYEE_LIST = ["田科培", "李洪涛", "李娟", "周媛", "熊正江", "祁亚飞", "郝成慧", "张艺", "朱兴", "丁靖", "张庭瑞", "张洲", "黄金", "王露", "李雪琦", "李雨亭", "陈梦媛", "赵芯"];
        // ===================================================

        const YEAR = new Date().getFullYear();
        const WEEK_HEADERS = ["周一", "周二", "周三", "周四", "周五", "周六", "周日", "周汇总"];
        let currentSelectDate = "";
        let currentWeekRange = { start: "", end: "" };
        let db;
        let employeeUiMap = {}; 

        firebase.initializeApp(firebaseConfig);
        db = firebase.database();

        document.addEventListener('DOMContentLoaded', function() {
            initCalendarByMonth(YEAR);
            bindBaseEvent();
            document.getElementById('exportWeek').style.display = 'none';
        });

        function bindBaseEvent() {
            document.getElementById('backCalendar').addEventListener('click', () => {
                document.getElementById('calendar').classList.add('active');
                document.getElementById('scheduleTable').classList.remove('active');
                document.getElementById('weekSummaryTable').classList.remove('active');
                document.getElementById('exportWeek').style.display = 'none';
                if (currentSelectDate) db.ref(`schedules/${currentSelectDate}`).off();
                employeeUiMap = {};
                currentWeekRange = { start: "", end: "" };
            });
        }

        // 核心修复：按月生成日历
        function initCalendarByMonth(year) {
            const calendar = document.getElementById('calendar');
            calendar.innerHTML = '';
            
            for (let month = 0; month < 12; month++) {
                const monthContainer = document.createElement('div');
                monthContainer.className = 'calendar-month';

                const monthTitle = document.createElement('div');
                monthTitle.className = 'month-title';
                monthTitle.innerHTML = `${year}年${month + 1}月`;
                monthContainer.appendChild(monthTitle);

                const weekHeader = document.createElement('div');
                weekHeader.className = 'month-week-header';
                WEEK_HEADERS.forEach(week => {
                    const span = document.createElement('span');
                    span.innerHTML = week;
                    weekHeader.appendChild(span);
                });
                monthContainer.appendChild(weekHeader);

                const daysContainer = document.createElement('div');
                daysContainer.className = 'month-days';

                const firstDayOfMonth = new Date(year, month, 1);
                let firstDayWeek = firstDayOfMonth.getDay(); 
                firstDayWeek = firstDayWeek === 0 ? 6 : firstDayWeek - 1; 

                for (let i = 0; i < firstDayWeek; i++) {
                    const emptyCell = document.createElement('div');
                    emptyCell.className = 'day-cell empty';
                    daysContainer.appendChild(emptyCell);
                }

                const totalDays = new Date(year, month + 1, 0).getDate();
                let currentColumn = firstDayWeek; 
                let weekStartDate = null; 

                for (let day = 1; day <= totalDays; day++) {
                    const currentDate = new Date(year, month, day);
                    const dateStr = formatDate(currentDate);
                    
                    if (currentColumn === 0) {
                        weekStartDate = new Date(currentDate);
                    }

                    const dayCell = document.createElement('div');
                    dayCell.className = 'day-cell';
                    dayCell.innerHTML = day;
                    if (isCurrentDay(currentDate)) dayCell.classList.add('today');
                    dayCell.addEventListener('click', () => {
                        currentSelectDate = dateStr;
                        renderScheduleTable(dateStr);
                    });
                    daysContainer.appendChild(dayCell);

                    if (currentColumn === 6) {
                        if (!weekStartDate) {
                            weekStartDate = new Date(currentDate);
                            weekStartDate.setDate(currentDate.getDate() - 6);
                        }
                        addWeekButton(daysContainer, weekStartDate, currentDate); 
                        currentColumn = 0; 
                    } else {
                        currentColumn++; 
                    }
                }

                if (currentColumn !== 0) {
                    for (let i = currentColumn; i <= 6; i++) {
                        const emptyCell = document.createElement('div');
                        emptyCell.className = 'day-cell empty';
                        daysContainer.appendChild(emptyCell);
                    }
                    
                    const lastDay = new Date(year, month, totalDays);
                    if (!weekStartDate) { 
                         weekStartDate = new Date(lastDay);
                         let dayIndex = (lastDay.getDay() === 0 ? 6 : lastDay.getDay() - 1);
                         weekStartDate.setDate(lastDay.getDate() - dayIndex);
                    }
                    let weekEndDate = new Date(weekStartDate);
                    weekEndDate.setDate(weekEndDate.getDate() + 6);

                    addWeekButton(daysContainer, weekStartDate, weekEndDate);
                }

                monthContainer.appendChild(daysContainer);
                calendar.appendChild(monthContainer);
            }
        }

        function addWeekButton(container, startDate, endDate) {
            const startStr = formatDate(startDate);
            const endStr = formatDate(endDate);
            
            const btnCell = document.createElement('div');
            btnCell.className = 'week-view-btn-cell';
            
            const viewBtn = document.createElement('button');
            viewBtn.className = 'week-view-btn';
            viewBtn.innerHTML = '查看<br>周汇总'; 
            viewBtn.addEventListener('click', () => {
                currentWeekRange = { start: startStr, end: endStr };
                renderWeekSummary(startStr, endStr);
            });
            
            btnCell.appendChild(viewBtn);
            container.appendChild(btnCell);
        }

        function renderScheduleTable(dateStr) {
            const calendar = document.getElementById('calendar');
            const scheduleTable = document.getElementById('scheduleTable');
            const weekSummaryTable = document.getElementById('weekSummaryTable');
            const dateTitle = document.getElementById('dateTitle');
            const scheduleTbody = document.getElementById('scheduleTbody');

            calendar.classList.remove('active');
            weekSummaryTable.classList.remove('active');
            scheduleTable.classList.add('active');
            dateTitle.innerHTML = `${dateStr} 员工工作安排表`;
            document.getElementById('exportWeek').style.display = 'none';
            
            scheduleTbody.innerHTML = '';
            employeeUiMap = {};

            EMPLOYEE_LIST.forEach(employee => {
                const tr = document.createElement('tr');
                
                const tdEmployee = document.createElement('td');
                tdEmployee.className = 'employee';
                tdEmployee.innerHTML = employee;
                
                const tdStatus = document.createElement('td');
                const selectStatus = document.createElement('select');
                selectStatus.className = 'status-select';
                selectStatus.innerHTML = `
                    <option value="可安排">可安排</option>
                    <option value="暂不安排">暂不安排</option>
                `;
                selectStatus.addEventListener('change', function() {
                    if(this.value === '暂不安排') {
                        this.classList.add('unavailable');
                    } else {
                        this.classList.remove('unavailable');
                    }
                    saveScheduleToFirebase(dateStr, employee);
                });
                tdStatus.appendChild(selectStatus);

                const tdInput = document.createElement('td');
                tdInput.className = 'input-cell';
                tdInput.contentEditable = true;
                
                employeeUiMap[employee] = {
                    input: tdInput,
                    select: selectStatus
                };

                let saveTimer = null;
                tdInput.addEventListener('input', () => {
                    clearTimeout(saveTimer);
                    saveTimer = setTimeout(() => {
                        saveScheduleToFirebase(dateStr, employee);
                    }, 300);
                });

                tr.appendChild(tdEmployee);
                tr.appendChild(tdStatus);
                tr.appendChild(tdInput);
                scheduleTbody.appendChild(tr);
            });

            const scheduleRef = db.ref(`schedules/${dateStr}`);
            scheduleRef.on('value', (snapshot) => {
                const dayData = snapshot.val() || {};
                EMPLOYEE_LIST.forEach(employee => {
                    const ui = employeeUiMap[employee];
                    const rawData = dayData[employee];
                    
                    let content = "";
                    let status = "可安排";

                    if (typeof rawData === 'object' && rawData !== null) {
                        content = rawData.content || "";
                        status = rawData.status || "可安排";
                    } else if (typeof rawData === 'string') {
                        content = rawData;
                        status = "可安排";
                    }

                    if (ui.input !== document.activeElement) {
                        ui.input.innerHTML = content;
                    }
                    if (ui.select.value !== status) {
                        ui.select.value = status;
                        if(status === '暂不安排') ui.select.classList.add('unavailable');
                        else ui.select.classList.remove('unavailable');
                    }
                });
            });

            document.getElementById('exportToday').onclick = () => exportTodayExcel(dateStr);
            document.getElementById('exportAll').onclick = () => exportAllExcel();
        }

        // ================= 重写周汇总渲染函数 =================
        function renderWeekSummary(weekStartStr, weekEndStr) {
            const calendar = document.getElementById('calendar');
            const scheduleTable = document.getElementById('scheduleTable');
            const weekSummaryTable = document.getElementById('weekSummaryTable');
            const weekSummaryTitle = document.getElementById('weekSummaryTitle');
            const weekSummaryThead = document.getElementById('weekSummaryThead');
            const weekSummaryTbody = document.getElementById('weekSummaryTbody');

            calendar.classList.remove('active');
            scheduleTable.classList.remove('active');
            weekSummaryTable.classList.add('active');
            weekSummaryTitle.innerHTML = `${weekStartStr} 至 ${weekEndStr} 员工工作安排周汇总`;
            document.getElementById('exportWeek').style.display = 'inline-block';

            // 生成本周日期列表
            const weekDateList = [];
            let currentDate = new Date(weekStartStr);
            while (currentDate <= new Date(weekEndStr)) {
                weekDateList.push(formatDate(currentDate));
                currentDate.setDate(currentDate.getDate() + 1);
            }

            // --- 构造双层表头 ---
            weekSummaryThead.innerHTML = '';
            
            // 第一行：日期（跨两列）
            const trDate = document.createElement('tr');
            // 首列空白（对应员工姓名）
            trDate.innerHTML = '<th rowspan="2" style="min-width:100px; z-index:3; left:0; position:sticky; background:#f2f2f2;">员工姓名</th>';
            weekDateList.forEach(dateStr => {
                // 日期跨两列
                trDate.innerHTML += `<th colspan="2" style="border-bottom:1px solid #ddd;">${dateStr}</th>`;
            });
            weekSummaryThead.appendChild(trDate);

            // 第二行：状态 | 内容
            const trSub = document.createElement('tr');
            weekDateList.forEach(() => {
                trSub.innerHTML += `
                    <th style="min-width:60px; color:#666; font-size:12px;">状态</th>
                    <th style="min-width:150px; color:#666; font-size:12px;">工作内容</th>
                `;
            });
            weekSummaryThead.appendChild(trSub);


            // --- 构造数据体 ---
            weekSummaryTbody.innerHTML = '';
            db.ref(`schedules`).once('value', (snapshot) => {
                const allScheduleData = snapshot.val() || {};
                
                EMPLOYEE_LIST.forEach(employee => {
                    const tr = document.createElement('tr');
                    const tdEmployee = document.createElement('td');
                    tdEmployee.className = 'employee';
                    tdEmployee.innerHTML = employee;
                    tr.appendChild(tdEmployee);

                    weekDateList.forEach(dateStr => {
                        const dayData = allScheduleData[dateStr] || {};
                        const rawData = dayData[employee];
                        
                        // 解析数据
                        let content = "";
                        let status = "可安排";
                        if (typeof rawData === 'object' && rawData !== null) {
                            content = rawData.content || "";
                            status = rawData.status || "可安排";
                        } else if (typeof rawData === 'string') {
                            content = rawData;
                        }

                        // 1. 状态列
                        const tdStatus = document.createElement('td');
                        tdStatus.className = 'status-cell';
                        tdStatus.innerHTML = status;
                        if (status === '暂不安排') {
                            tdStatus.classList.add('unavailable');
                        }
                        tr.appendChild(tdStatus);

                        // 2. 内容列
                        const tdContent = document.createElement('td');
                        tdContent.innerHTML = content;
                        tr.appendChild(tdContent);
                    });
                    weekSummaryTbody.appendChild(tr);
                });
            });

            document.getElementById('exportToday').onclick = () => exportTodayExcel(currentSelectDate);
            document.getElementById('exportAll').onclick = () => exportAllExcel();
            // 导出函数传递日期列表
            document.getElementById('exportWeek').onclick = () => exportWeekExcel(weekStartStr, weekEndStr, weekDateList);
        }
        // ====================================================

        function saveScheduleToFirebase(dateStr, employee) {
            const ui = employeeUiMap[employee];
            if (!ui) return;
            
            const content = ui.input.innerHTML;
            const status = ui.select.value;

            db.ref(`schedules/${dateStr}/${employee}`).set({
                content: content,
                status: status
            });
        }

        function exportTodayExcel(dateStr) {
            if (!dateStr) return alert("请先选择日期");
            db.ref(`schedules/${dateStr}`).once('value', (snapshot) => {
                const dayData = snapshot.val() || {};
                const excelData = [
                    ['员工姓名', '状态', '当日工作安排'],
                    ...EMPLOYEE_LIST.map(emp => {
                        const rawData = dayData[emp];
                        let content = "", status = "可安排";
                        if (typeof rawData === 'object' && rawData !== null) {
                            content = rawData.content || "";
                            status = rawData.status || "可安排";
                        } else if (typeof rawData === 'string') {
                            content = rawData;
                        }
                        content = content.replace(/<[^>]+>/g, "").trim();
                        return [emp, status, content];
                    })
                ];
                const wb = XLSX.utils.book_new();
                const ws = XLSX.utils.aoa_to_sheet(excelData);
                XLSX.utils.book_append_sheet(wb, ws, dateStr);
                XLSX.writeFile(wb, `${dateStr}员工工作安排表.xlsx`);
            });
        }

        // ================= 更新周导出Excel函数 =================
        function exportWeekExcel(weekStartStr, weekEndStr, weekDateList) {
            db.ref(`schedules`).once('value', (snapshot) => {
                const allScheduleData = snapshot.val() || {};
                
                // 构造表头行
                const headerRow = ['员工姓名'];
                weekDateList.forEach(dateStr => {
                    headerRow.push(`${dateStr} 状态`);
                    headerRow.push(`${dateStr} 工作内容`);
                });

                const excelData = [
                    headerRow,
                    ...EMPLOYEE_LIST.map(employee => {
                        const row = [employee];
                        weekDateList.forEach(dateStr => {
                            const dayData = allScheduleData[dateStr] || {};
                            const rawData = dayData[employee];
                            
                            let content = "";
                            let status = "可安排";
                            if (typeof rawData === 'object' && rawData !== null) {
                                content = rawData.content || "";
                                status = rawData.status || "可安排";
                            } else if (typeof rawData === 'string') {
                                content = rawData;
                            }
                            // 清理HTML标签
                            content = content.replace(/<br>/g, "\n").replace(/<[^>]+>/g, "").trim();
                            
                            row.push(status);
                            row.push(content);
                        });
                        return row;
                    })
                ];
                
                const wb = XLSX.utils.book_new();
                const ws = XLSX.utils.aoa_to_sheet(excelData);
                // 设置列宽稍微好看一点（可选优化）
                // wch 是字符宽度
                const wscols = [{wch: 10}]; // 姓名列
                weekDateList.forEach(() => {
                    wscols.push({wch: 10}); // 状态列
                    wscols.push({wch: 30}); // 内容列
                });
                ws['!cols'] = wscols;

                XLSX.utils.book_append_sheet(wb, ws, `${weekStartStr}至${weekEndStr}`);
                XLSX.writeFile(wb, `${weekStartStr}至${weekEndStr}员工工作安排周汇总.xlsx`);
            });
        }
        // ====================================================

        function exportAllExcel() {
            db.ref(`schedules`).once('value', (snapshot) => {
                const allData = snapshot.val() || {};
                const wb = XLSX.utils.book_new();
                const sheetNames = Object.keys(allData).sort();
                if (sheetNames.length === 0) return alert("暂无数据可导出");
                
                sheetNames.forEach(dateStr => {
                    const dayData = allData[dateStr];
                    const excelData = [
                        ['员工姓名', '状态', '当日工作安排'],
                        ...EMPLOYEE_LIST.map(emp => {
                            const rawData = dayData[emp];
                            let content = "", status = "可安排";
                            if (typeof rawData === 'object' && rawData !== null) {
                                content = rawData.content || "";
                                status = rawData.status || "可安排";
                            } else if (typeof rawData === 'string') {
                                content = rawData;
                            }
                            content = content.replace(/<[^>]+>/g, "").trim();
                            return [emp, status, content];
                        })
                    ];
                    const ws = XLSX.utils.aoa_to_sheet(excelData);
                    XLSX.utils.book_append_sheet(wb, ws, dateStr);
                });
                XLSX.writeFile(wb, `${YEAR}年员工工作安排汇总表.xlsx`);
            });
        }

        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function isCurrentDay(date) {
            const today = new Date();
            return date.getFullYear() === today.getFullYear() &&
                   date.getMonth() === today.getMonth() &&
                   date.getDate() === today.getDate();
        }
    </script>
</body>
</html>
